---
id: api
title: API
---

import { Form, FormItem } from '@rexd/xform';

{ğŸš€} è¡¨ç¤ºè¿›é˜¶ APIã€‚

## ç»„ä»¶

### `Form`

è¡¨å•ç»„ä»¶ï¼Œæ¸²æŸ“ä¸€ä¸ª div å¹¶åˆ›å»ºè¡¨å•æ‰€éœ€çš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ React Contextï¼š

- FormEnvProviderï¼šè¡¨å•çš„ç¯å¢ƒå˜é‡ï¼Œå­ç»„ä»¶å¯ä»¥é€šè¿‡ [`useFormEnv`](#useformenv) è·å–è¿™äº›ç¯å¢ƒå˜é‡
- ModelProviderï¼šæ¨¡å‹å¯¹è±¡ï¼Œå­ç»„ä»¶å¯ä»¥é€šè¿‡ [`useModel`](#usemodel) è·å–æ¨¡å‹å¯¹è±¡
- FormLayoutï¼š æ¥è‡ª `@rexd/core` çš„è¡¨å•å¸ƒå±€èƒ½åŠ›

<PropsTable component={Form} />

### `FormItem`

è¡¨å•é¡¹ ç»„ä»¶ï¼Œæ¸²æŸ“ä¸€ä¸ª FormControlï¼ŒåŒ…å«é¡¹ç›®æ ‡ç­¾ï¼ˆlabelï¼‰ã€é”™è¯¯ä¿¡æ¯ã€å¯é€‰çš„å¸®åŠ©ä¿¡æ¯ï¼Œä»¥åŠå…·ä½“çš„æ§ä»¶å®ä¾‹ï¼ˆä¾‹å¦‚ä¸€ä¸ªè¾“å…¥æ¡†ï¼‰ã€‚

<PropsTable
  props={[
    { name: 'component', required: true, type: 'string', description: 'ç»„ä»¶ç±»å‹' },
    { name: 'name', required: true, type: 'string', description: 'å­—æ®µæ•°æ®ç´¢å¼•' },
    { name: 'label', required: true, type: 'ReactNode', description: 'å­—æ®µçš„æ˜¾ç¤ºåç§°' },
    { name: 'defaultValue', description: 'é»˜è®¤å€¼' },
    { name: 'componentProps', description: 'ç»„ä»¶çš„ props' },
    { category: 'æ ¡éªŒ', name: 'validate', type: '(value: any) => any', description: 'æ ¡éªŒæ–¹æ³•' },
    { category: 'æ ¡éªŒ', name: 'required', type: 'boolean', defaultValue: 'false', description: 'å­—æ®µæ˜¯å¦å¿…å¡«' },
    { category: 'æ ¡éªŒ', name: 'requiredMessage', type: 'string', description: 'å¼€å‘ä¸­. å¿…å¡«å­—æ®µçš„è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯' },
    { name: 'dataSource', description: 'æ•°æ®æºï¼ˆå³å°†è¢«ç§»é™¤ï¼Œè¯·ä½¿ç”¨ componentProps.dataSource ä»£æ›¿ï¼‰' },
    { category: '{ğŸš€}', name: 'value', description: 'è¦†ç›–è¡¨å•é¡¹é»˜è®¤çš„ value' },
    { category: '{ğŸš€}', name: 'onChange', description: 'è¦†ç›–è¡¨å•é¡¹é»˜è®¤çš„ onChange' },
    { category: '{ğŸš€}', name: 'onBlur', description: 'è¦†ç›–è¡¨å•é¡¹é»˜è®¤çš„ onBlur' },
    { category: '{ğŸš€}', name: 'items', description: 'æµ‹è¯•ç”¨ï¼Œå³å°†è¢«ç§»é™¤ï¼Œå‹¿ä½¿ç”¨' },
  ]}
/>

### `Form.Submit`

è¡¨å•æäº¤[æŒ‰é’®](../button)ï¼Œç‚¹å‡»æ—¶...

- è§¦å‘æ‰€æœ‰å­—æ®µçš„æ ¡éªŒ
- å¦‚æœæ ¡éªŒé€šè¿‡ï¼Œåˆ™è°ƒç”¨ `onSubmit(submitValues, model)`
- å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è°ƒç”¨ `onSubmit(erros, model)`

### `Form.Reset`

è¡¨å•é‡ç½®[æŒ‰é’®](../button)ï¼Œç‚¹å‡»æ—¶å°†æ¸…ç©º values ä¸æ ¡éªŒé”™è¯¯ï¼Œç„¶åè§¦å‘ `onReset`ã€‚

### `Form.Effect`

`<Form.Effect watch={watch} effect={effect} />`

åˆ›å»ºè¡¨å•è”åŠ¨ï¼Œæ¯å½“ watch å¯¹åº”çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œeffect éƒ½ä¼šè¢«è°ƒç”¨ã€‚æ³¨æ„åµŒå¥—å­—æ®µçš„å˜æ›´ä¹Ÿä¼šè§¦å‘ effectã€‚

effect è¢«è°ƒç”¨æ—¶ï¼Œå¯ä»¥è·å–åˆ°ä¸¤ä¸ªå‚æ•°ï¼š

- `value: any` æ–°çš„å€¼
- `detail: { prev: any, model: IModel, next: any }` ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ—§çš„å€¼ï¼Œæ–°çš„å€¼ï¼Œä»¥åŠå½“å‰æ¨¡å‹

### `Form.Array`

[{ğŸš€} ç”¨æ³•](advanced#formarray)ã€‚ ä»¥å½“å‰ model ä¸ºåŸºç¡€ï¼Œä¸ºå…¶å­èŠ‚ç‚¹æä¾›ä¸€ä¸ªæ–°çš„ sub modelï¼Œå¹¶å°†å­èŠ‚ç‚¹ä¸­çš„è¡¨å•å€¼æ”¶é›†åˆ°å½“å‰ model ä¸­ `{name}.{itemIndex}` å¯¹åº”çš„ä½ç½®ã€‚

<PropsTable
  props={[
    { name: 'name', type: 'string', required: true, description: 'å­—æ®µç´¢å¼•' },
    {
      name: 'layout',
      type: '(input: XFormArrayLayoutInput) => React.ReactElement',
      required: true,
      description:
        'æ•°ç»„å¸ƒå±€ï¼Œæ§åˆ¶è¡¨å•å¦‚ä½•å¯¹æ•°ç»„è¿›è¡Œå¸ƒå±€ï¼ŒåŒ…æ‹¬æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„å¸ƒå±€ ä»¥åŠ ç›¸å…³çš„æ“ä½œæŒ‰é’®ï¼ˆæ·»åŠ ã€åˆ é™¤ã€ä¸Šç§»ã€ä¸‹ç§»ç­‰ï¼‰',
    },
    {
      name: 'itemFactory',
      type: '(arrayModel: Model) => any',
      defaultValue: '() => ({})',
      description: 'æ•°ç»„ä¸­æ–°å¢å…ƒç´ çš„åˆå§‹å€¼, é»˜è®¤ä¸ºä¸€ä¸ªæ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡çš„å‡½æ•°',
    },
  ]}
/>

### `Form.Object`

[{ğŸš€} ç”¨æ³•](advanced#formobject)ã€‚ ä»¥å½“å‰ model ä¸ºåŸºç¡€ï¼Œä¸ºå…¶å­èŠ‚ç‚¹æä¾›ä¸€ä¸ªæ–°çš„ sub modelï¼Œå¹¶å°†å­èŠ‚ç‚¹ä¸­çš„è¡¨å•å€¼æ”¶é›†åˆ°å½“å‰ model ä¸­ name å¯¹åº”çš„ä½ç½®

<PropsTable props={[{ name: 'name', type: 'string', required: true, description: 'å­—æ®µç´¢å¼•' }]} />

### `Form.Field`

{ğŸš€} ç”¨äºåˆ›å»ºè‡ªå®šä¹‰çš„è¡¨å•é¡¹ç»„ä»¶ã€‚

TODO ç”¨æ³•ä»‹ç»

## contexts & hooks

### `useModel`

è·å–å½“å‰å±‚çº§çš„æ¨¡å‹å¯¹è±¡ã€‚

### `Form.ModelConsumer`

ModelContext çš„ [`Consumer`](https://zh-hans.reactjs.org/docs/context.html#contextconsumer)ï¼Œå¯ç”¨äºè®¢é˜…å½“å‰å±‚çº§çš„ modelã€‚

è¯¥ç»„ä»¶å·²ç»è¢«åŒ…è£¹åœ¨ [observer](https://mobx.js.org/react-integration.html) ä¸­ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ [render prop](https://zh-hans.reactjs.org/docs/render-props.html) ä¸­è¯»å– mobx observable å¯¹è±¡ã€‚

```jsx
<Form.ModelConsumer>
  {(model) => {
    const person = model.getSubModel('person');
    return <span>å§“åï¼š {person.getValue('name')}</span>;
  }}
</Form.ModelConsumer>
```

### `Form.ModelProvider`

{ğŸš€} ä¸»åŠ¨åœ¨ react context ä¸­è®¾ç½®æ¨¡å‹å¯¹è±¡ã€‚

`<Form.ModelProvider value={model}>{children}</Form.ModelProvider>`

### `useFormEnv`

{ğŸš€} è·å–å½“å‰å±‚çº§çš„ç¯å¢ƒå˜é‡ã€‚

### `FormEnvProvider`

{ğŸš€} åœ¨æŒ‡å®šçš„å±‚çº§è¦†ç›–è¡¨å•çš„ç¯å¢ƒå˜é‡ã€‚

`<Form />` æ¸²æŸ“æ—¶ä¼šè‡ªåŠ¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¸€èˆ¬ä¸éœ€è¦å•ç‹¬ä½¿ç”¨ `<FormEnvProvider />`ã€‚ ç›®å‰é»˜è®¤æ”¯æŒè®¾ç½® `isPreview`ï¼š

```jsx
<Form>
  <FormItem name="aaa" />
  <FormItem name="bbb" />

  <FormEnvProvider isPreview>
    {/* ccc å’Œ ddd æ€»æ˜¯ä¼šå¤„äºé¢„è§ˆæ€ */}
    <FormItem name="ccc" />
    <FormItem name="ddd" />
  </FormEnvProvider>
</Form>
```

FormEnvProvider æ¥å—ä»»æ„çš„ propsï¼Œè®¾ç½®åå­ç»„ä»¶å¯ä»¥é€šè¿‡ `useFormEnv()` è·å–åˆ°è¿™äº›ç¯å¢ƒå˜é‡ï¼ˆæ³¨æ„ TypeScript ç±»å‹ä¿¡æ¯è¦è¿›è¡Œç›¸åº”çš„æ‹“å±•ï¼‰ã€‚

è®¾ç½® FormEnvProvider æ—¶ï¼Œæ–°çš„ç¯å¢ƒå˜é‡ä¼šä¸ä¸Šå±‚çš„ç¯å¢ƒå˜é‡è¿›è¡Œåˆå¹¶ï¼Œç„¶åä¼ é€’ç»™å­ç»„ä»¶ã€‚

## æ•°ç»„å¸ƒå±€ {ğŸš€}

éœ€è¦é…åˆ `Form.Array` ä½¿ç”¨

### `arrayCard`

{ğŸš€} å¡ç‰‡å¸ƒå±€

```tsx
interface ArrayCardOptions {
  title?: string;
  showItemCount?: boolean;
  showItemOrder?: boolean;
  style?: React.CSSProperties;
}
```

### `arrayTable`

{ğŸš€} è¡¨æ ¼å¸ƒå±€

```tsx
interface ArrayTableOptions {
  defaultColumnWidth?: number;
  operationColumn?: Partial<Column>;
  orderColumn?: Partial<Column>;
  style?: React.CSSProperties;
  className?: string;
}
```

## æ¨¡å‹ä¸å·¥å…·

### `Model`

Model è¡¨ç¤ºã€Œä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„å¯¹åº”çš„è¡¨å•æ¨¡å‹éƒ¨åˆ†ã€ã€‚

- `model.getSubModel(name): Model` è·å–ä¸€ä¸ªå­æ¨¡å‹
- `model.getSubArray(name): Model` è·å–ä¸€ä¸ªå­æ¨¡å‹ï¼Œä½†è·å–çš„å­æ¨¡å‹çš„æ•°æ®æ ¼å¼ä¸ºæ•°ç»„
- `model.getField(name): Field` è·å– name å¯¹åº”çš„å­—æ®µå¯¹è±¡
- `model.root: RootModel` æŒ‡å‘ RootModel
- `model.path: string[]` ä» RootModel åˆ°å½“å‰ model çš„æ•°æ®è·¯å¾„
- `model.parent: IModel` æŒ‡å‘ä¸Šä¸€çº§çš„ model
- `model.values` æ¨¡å‹ä¸Šçš„æ•°æ®ï¼Œè¿™æ˜¯ä¸€ä¸ª mobx computed å­—æ®µ
- `model.getValue(name, defaultValue)` ä»¥å½“å‰æ¨¡å‹ä¸ºèµ·å§‹è·¯å¾„ï¼Œè¯»å– name å¤„çš„æ•°æ®
- `model.setValue(name, value)` ä»¥å½“å‰æ¨¡å‹ä¸ºèµ·å§‹è·¯å¾„ï¼Œä¿®æ”¹ name å¤„çš„æ•°æ®
- `model.state` æ¨¡å‹çº§åˆ«çš„çŠ¶æ€ï¼Œè¿™æ˜¯ä¸€ä¸ª mobx observable å¯¹è±¡ï¼Œé»˜è®¤ä¸º `{}`ï¼Œä¸€èˆ¬ç”¨æ¥ç®¡ç†ä¸€äº›è¡¨å•çš„ UI çŠ¶æ€ã€‚
- `model.id: string` æ¨¡å‹åœ¨æ‰€å± RootModel å†…çš„å”¯ä¸€ id

### `Field`

Field ç”¨æ¥è¡¨ç¤ºã€Œä¸€ä¸ª è§†å›¾æ§ä»¶ å¯¹åº”çš„è¡¨å•æ¨¡å‹éƒ¨åˆ†ã€ã€‚

- `field.value` è¯»å–æˆ–è®¾ç½®å­—æ®µçš„å€¼ï¼Œè¿™æ˜¯ä¸€ä¸ª mobx computed å­—æ®µ
- `field.state` å­—æ®µçŠ¶æ€ï¼Œè¿™æ˜¯ä¸€ä¸ª mobx observable å¯¹è±¡ï¼Œé»˜è®¤ä¸º `{}`ã€‚
  - ç›®å‰ï¼Œæˆ‘ä»¬çº¦å®šäº† `field.state.error` ä½œä¸ºè¯¥å­—æ®µä¸Šçš„é”™è¯¯çŠ¶æ€ï¼Œå½“ state.error æœ‰å€¼æ—¶ï¼Œé¡µé¢ä¸­å°±ä¼šå±•ç¤ºå¯¹åº”çš„å‡ºé”™æç¤ºã€‚
- `field.config` å­—æ®µé…ç½®ä¿¡æ¯ï¼Œåæ˜ è¯¥å­—æ®µå¯¹åº”çš„æ§ä»¶æœ€è¿‘ä¸€æ¬¡è¢«æ¸²æŸ“æ—¶ React Element ä¸Šçš„ props
- `field.id: string` å­—æ®µåœ¨æ‰€å±è¡¨å•å†…çš„å”¯ä¸€ id
- `field.mountCount: number` å­—æ®µå¯¹åº”çš„æ§ä»¶çš„åŠ è½½æ•°é‡
- `field.path: string[]` ä» RootModel åˆ°è¯¥å­—æ®µçš„å®Œæ•´è·¯å¾„
- `field.parent: IModel` æŒ‡å‘ä¸Šä¸€çº§çš„ model

### `modelUtils.clearError`

`modelUtils.clearError(model : IModel): void`

mobx action. æ¸…é™¤ model ä¸Šæ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯

### `modelUtils.validateAll`

`modelUtils.validateAll(model: IModel): { hasError: boolean, errors: any }`

mobx action. æ‰§è¡Œ model ä¸Šæ‰€æœ‰çš„æ ¡éªŒï¼Œå¹¶è¿”å›æ‰€æœ‰çš„æŠ¥é”™ä¿¡æ¯

### `fieldUtils.validate`

`fieldUtils.validate(field: Field): any`

mobx action. æ‰§è¡ŒæŒ‡å®šå­—æ®µä¸Šçš„æ ¡éªŒï¼Œè¿”å›æŠ¥é”™ä¿¡æ¯ã€‚

### `fieldUtils.handleBlur`

{ğŸš€} `fieldUtils.handleBlur(field: Field): void`

mobx action. blur äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä¸€èˆ¬åœ¨åˆ›å»ºè‡ªå®šä¹‰çš„è¡¨å•é¡¹ç»„ä»¶æ—¶ä½¿ç”¨ã€‚

### `fieldUtils.handleChange`

{ğŸš€} `fieldUtils.handleChange(field: Field, nextValue: any): void`

mobx action. change äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä¸€èˆ¬åœ¨åˆ›å»ºè‡ªå®šä¹‰çš„è¡¨å•é¡¹ç»„ä»¶æ—¶ä½¿ç”¨ã€‚

### `makeAsyncValue`

{ğŸš€} å¼€å‘ä¸­
